<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Palmu ランク管理ツール</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <header style="margin-bottom: 10px;">
      <h1>
        Palmu ランク管理
        <span class="pill">7日間＋数トラッカー</span>
      </h1>
      <div class="subtitle">
        7日間の<b>＋数合計</b>から、<b>ランクアップ / キープ / ダウン</b>を自動判定。<br />
        ランクごとの必要ポイントと、ざっくりコイン数の目安も一緒に見える化。
      </div>
    </header>

    <!-- 設定 & ダッシュボード -->
    <section class="grid grid-2" style="margin-bottom: 16px;">
      <!-- ダッシュボード -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">現在の状況</div>
            <div class="card-sub">7日間の＋数とランク判定・ノルマ表示</div>
          </div>
          <div id="currentRankBadges">
            <!-- 現在ランクなどのバッジ -->
          </div>
        </div>

        <div class="stat-row">
          <div class="stat-label">7日間＋数合計</div>
          <div class="stat-value stat-highlight"><span id="sum7">0</span> pt</div>
        </div>

        <div class="stat-row">
          <div class="stat-label">この7日間の期間</div>
          <div class="stat-value">
            <span id="periodStart">-</span> 〜 <span id="periodEnd">-</span>
          </div>
        </div>

        <div class="progress">
          <div id="progressBar" class="progress-bar"></div>
        </div>

        <div style="margin-top: 10px;">
          <div class="stat-row">
            <div class="stat-label" id="upConditionLabel">ランクアップ条件（18pt以上）</div>
            <div class="stat-value">
              あと <span id="needUpPoints">18</span> pt
              （目安 <span id="needUpCoins">-</span> コイン）
            </div>
          </div>
          <div class="stat-row">
            <div class="stat-label" id="keepConditionLabel">キープ条件（12pt以上）</div>
            <div class="stat-value">
              あと <span id="needKeepPoints">12</span> pt
              （目安 <span id="needKeepCoins">-</span> コイン）
            </div>
          </div>
          <div class="stat-row">
            <div class="stat-label">ダウン回避までの余裕</div>
            <div class="stat-value">
              <span id="safeMarginPoints">-</span>
            </div>
          </div>
          <div class="stat-row">
            <div class="stat-label">現在の判定</div>
            <div class="stat-value">
              <span id="statusBadge" class="badge badge-keep">データ不足</span>
            </div>
          </div>

          <div class="stat-row">
            <div class="stat-label">今日の目安（UPを目指す場合）</div>
            <div class="stat-value">
              <span id="todayTargetPt">-</span><br />
              目安コイン：<span id="todayTargetCoins">-</span>
            </div>
          </div>
        </div>

        <div class="chips">
          <span class="chip">UP: 7日合計 <span id="chipUpThreshold">18</span>pt以上</span>
          <span class="chip">KEEP: <span id="chipKeepThreshold">12</span>〜UP未満</span>
          <span class="chip">DOWN: <span id="chipDownThreshold">11</span>pt以下</span>
        </div>

        <div class="text-small" style="margin-top: 6px;">
          ※終了日は「開始日 or 最新入力日」＋ スキップ日数です。<br />
          その終了日からさかのぼって7日間を集計しています。
        </div>
      </div>

      <!-- 設定 -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">基本設定</div>
            <div class="card-sub">ランク・期間・コイン換算の設定</div>
          </div>
        </div>

        <div style="display: grid; gap: 8px;">
          <div>
            <label for="currentRank">現在のランク</label>
            <select id="currentRank">
              <!-- JSでランク一覧を挿入 -->
            </select>
            <div class="text-small">
              ※A1からスタート（必要に応じて変更）。
            </div>
          </div>

          <div>
            <label for="periodStartInput">7日間の開始日</label>
            <input id="periodStartInput" type="date" />
            <div class="text-small">
              この日から7日間（＋スキップ日数）を集計対象にします。<br />
              未設定の場合は「最新入力日ベース」で自動計算。
            </div>
          </div>

          <div>
            <label for="skipDays">スキップカード（日数）</label>
            <input id="skipDays" type="number" min="0" max="7" step="1" />
            <div class="text-small">
              例：スキップ1枚で1日遅延させたら「1」。<br />
              0ならスキップなしとして計算します。
            </div>
          </div>

          <div>
            <label for="coinsPerPoint">1ptあたりのコイン数（手動上書き・任意）</label>
            <input id="coinsPerPoint" type="number" min="0" step="100" placeholder="例）2000" />
            <div class="text-small">
              ランクごとのデフォルト値は <code>app.js</code> の <b>DEFAULT_RANK_CONFIG</b> に定義。<br />
              ここに入力すると、その値で上書きして計算します。
            </div>
          </div>

          <div>
            <label>ランク概要</label>
            <div class="text-small">
              次のランク：<span id="nextRankLabel" class="muted">-</span><br />
              ひとつ下のランク：<span id="prevRankLabel" class="muted">-</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 入力フォーム -->
    <section class="card" style="margin-bottom: 16px;">
      <div class="card-header">
        <div>
          <div class="card-title">デイリー＋数入力</div>
          <div class="card-sub">日ごとの＋数・コイン・メモを記録</div>
        </div>
      </div>

      <form id="entryForm">
        <div style="display: grid; gap: 8px; margin-bottom: 6px;">
          <div class="input-row">
            <div>
              <label for="date">日付</label>
              <input id="date" type="date" required />
            </div>
            <div>
              <label for="drp">＋数</label>
              <input id="drp" type="number" min="0" step="1" required />
            </div>
          </div>
          <div class="input-row">
            <div>
              <label for="coins">その日に使われたコイン数（目安）</label>
              <input id="coins" type="number" min="0" step="100" />
            </div>
            <div>
              <label for="hours">配信時間（任意・メモ）</label>
              <input id="hours" type="text" placeholder="例）2.5h / 3枠 など" />
            </div>
          </div>
          <div>
            <label for="memo">メモ（イベント名・特記事項など）</label>
            <textarea id="memo" placeholder="例）◯◯イベント最終日 / コラボ配信 など"></textarea>
          </div>
        </div>

        <button type="submit" class="btn">
          <span>＋ この日のデータを追加</span>
        </button>
      </form>

      <div class="text-small" style="margin-top: 6px;">
        ※同じ日付を複数回登録したい場合は、＋数を合算して1行にまとめておくと見やすいです。
      </div>
    </section>

    <!-- 履歴テーブル -->
    <section class="card">
      <div class="card-header">
        <div>
          <div class="card-title">入力済みデータ（新しい順 上位30件）</div>
          <div class="card-sub">
            7日間の集計は、開始日 or 最新入力日＋スキップ日数 から逆算して計算しています。
          </div>
        </div>
        <button id="clearAll" class="btn-sm danger">全部削除</button>
      </div>

      <table id="entriesTable">
        <thead>
          <tr>
            <th>日付</th>
            <th class="text-right">＋数</th>
            <th class="text-right">コイン</th>
            <th>メモ</th>
            <th class="text-right">操作</th>
          </tr>
        </thead>
        <tbody>
          <!-- JSで挿入 -->
        </tbody>
      </table>

      <div class="text-small" style="margin-top: 6px;">
        ※データは Firebase Firestore に保存されます。PC・スマホ・複数人で共有できます。
      </div>
    </section>
  </div>

  <!-- Firebase SDK（compat版） -->
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>

  <!-- アプリ本体 -->
  <script src="app.js"></script>
</body>
</html>
